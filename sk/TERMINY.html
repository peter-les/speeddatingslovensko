<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>TERMINY - Speed Dating Bratislava</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body {
      background-color: #4CAF50;
      color: black;
      text-align: center;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header, footer {
      background-color: black;
      color: white;
      padding: 10px;
    }
    header a, footer a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
    }
    main {
      flex: 1;
      padding: 20px;
    }
    .flex-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }
    .column {
      min-width: 280px;
    }
    input, select, button {
      margin: 5px;
      padding: 8px;
      width: 90%;
    }
    .counter {
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

<header>
  <a href="index.html">Domov</a> |
  <a href="AKO_TO_PREBIEHA.html">Ako to prebieha</a> |
  <a href="TERMINY.html">Termíny</a> |
  <a href="O_NAS.html">O nás</a>
</header>

<main>
<h1>Nasledujúce termíny</h1>

<div class="flex-container">

<!-- 26–36 -->
<div class="column">
<h2>26–36 rokov (piatok)</h2>

<div class="counter">
Muži: <span id="m2636">0</span><br>
Ženy: <span id="z2636">0</span>
</div>

<ul>
<li>
<strong>Dátum:</strong> ...<br>
<strong>Čas:</strong> 18:00 – 19:00<br>
<strong>Adresa:</strong> ...<br>
<strong>Mesto:</strong> Bratislava
</li>
</ul>

<input id="name2636" placeholder="Krstné meno">
<input id="age2636" type="number" placeholder="Vek">
<select id="gender2636">
  <option value="">Pohlavie</option>
  <option value="muzi">Muž</option>
  <option value="zeny">Žena</option>
</select>

<button onclick="pay2636()">Pokračovať na platbu</button>
</div>

<!-- 36–46 -->
<div class="column">
<h2>36–46 rokov (sobota)</h2>

<div class="counter">
Muži: <span id="m3646">0</span><br>
Ženy: <span id="z3646">0</span>
</div>

<ul>
<li>
<strong>Dátum:</strong> ...<br>
<strong>Čas:</strong> 18:00 – 19:00<br>
<strong>Adresa:</strong> ...<br>
<strong>Mesto:</strong> Bratislava
</li>
</ul>

<input id="name3646" placeholder="Krstné meno">
<input id="age3646" type="number" placeholder="Vek">
<select id="gender3646">
  <option value="">Pohlavie</option>
  <option value="muzi">Muž</option>
  <option value="zeny">Žena</option>
</select>

<button onclick="pay3646()">Pokračovať na platbu</button>
</div>

</div>
</main>

<footer>
<p>
<a href="mailto:bratislavaspeeddating@gmail.com" style="color:white;">bratislavaspeeddating@gmail.com</a><br>
<a href="OBCHODNE_PODMIENKY.html" style="color:white;">Obchodné podmienky</a> |
<a href="OCHRANA_OSOBNYCH_UDAJOV.html" style="color:white;">Ochrana osobných údajov</a>
</p>
</footer>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyBWuOkOK_ViW3Byns3h5LdZ5NFrPjSo_jM",
  authDomain: "speeddatingslovakia.firebaseapp.com",
  databaseURL: "https://speeddatingslovakia-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "speeddatingslovakia"
});
const db = firebase.database();

/* LIVE COUNTERS */
db.ref("volne_miesta_26_36").on("value", s=>{
  document.getElementById("m2636").textContent = s.val().muzi;
  document.getElementById("z2636").textContent = s.val().zeny;
});
db.ref("volne_miesta_36_46").on("value", s=>{
  document.getElementById("m3646").textContent = s.val().muzi;
  document.getElementById("z3646").textContent = s.val().zeny;
});

/* PAYMENT FLOWS */
function pay2636(){
  startPayment(
    "26_36",
    document.getElementById("name2636").value,
    document.getElementById("age2636").value,
    document.getElementById("gender2636").value,
    g => g==="muzi"
      ? "https://buy.stripe.com/test_7sY9AS2ObfKh2mH2Crc7u00"
      : "TU_DAS_STRIPE_LINK_3_90"
  );
}

function pay3646(){
  startPayment(
    "36_46",
    document.getElementById("name3646").value,
    document.getElementById("age3646").value,
    document.getElementById("gender3646").value,
    ()=>"https://buy.stripe.com/test_dRm6oGewTeGdaTdfpdc7u01"
  );
}

function startPayment(group,name,age,gender,getLink){
  if(!name||!age||!gender){ alert("Vyplň všetky údaje"); return; }

  localStorage.setItem("reg",JSON.stringify({group,name,age,gender}));

  const win = window.open(getLink(gender),"_blank");
  const timer=setInterval(()=>{
    if(win.closed){
      clearInterval(timer);
      finishRegistration();
    }
  },500);
}

function finishRegistration(){
  const r = JSON.parse(localStorage.getItem("reg"));
  const ref = db.ref("volne_miesta_"+r.group);
  ref.once("value").then(s=>{
    const d=s.val();
    if(d[r.gender]>0){
      d[r.gender]--;
      ref.set(d);
      db.ref("registracie_"+r.group).push({...r,time:Date.now()});
      alert("Registrácia úspešná!");
    } else alert("Už nie sú voľné miesta.");
  });
}
</script>

</body>
</html>
